<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Адмін Панель</title>
  <link rel="icon" href="1-17ffebdc.ico" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #050608 !important;
      color: #FFFBEF !important;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .admin-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .online {
      background-color: #4ade80;
      box-shadow: 0 0 8px #4ade80;
    }

    .offline {
      background-color: #f87171;
    }

    .never-logged {
      background-color: #94a3b8;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.9rem;
      background-color: #1a1a1a;
      color: #dcdcdc;
    }

    .admin-table thead {
      background-color: #222;
      position: sticky;
      top: 0;
    }

    .admin-table th {
      text-align: left;
      padding: 12px 15px;
      font-weight: 500;
      color: #b0b0b0;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .admin-table th:hover {
      background-color: #2a2a2a;
    }

    .admin-table td {
      padding: 12px 15px;
      border-top: 1px solid #2c2c2c;
    }

    .admin-table tbody tr:nth-child(even) {
      background-color: #1e1e1e;
    }

    .admin-table tbody tr:hover {
      background-color: #2a2a2a;
      transition: background-color 0.2s ease;
    }

    .highlight {
      background-color: #1e3a8a !important;
    }

    .rank-badge {
      display: inline-block;
      min-width: 24px;
      height: 24px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1e3a8a, #3b82f6);
      text-align: center;
      line-height: 24px;
      font-weight: bold;
      font-size: 0.85rem;
    }

    .rank-1 { background: linear-gradient(135deg, #fcd34d, #f59e0b); }
    .rank-2 { background: linear-gradient(135deg, #d1d5db, #9ca3af); }
    .rank-3 { background: linear-gradient(135deg, #92400e, #b45309); }

    .search-container {
      background-color: #121315;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
    }

    .search-box {
      flex-grow: 1;
      min-width: 250px;
    }

    .search-box input {
      width: 100%;
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      background-color: #1a1a1a;
      color: #FFFBEF;
      font-size: 1rem;
    }

    .filter-box {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-btn {
      padding: 8px 15px;
      border-radius: 8px;
      background-color: #1a1a1a;
      color: #FFFBEF;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
    }

    .filter-btn.active {
      background-color: #3b82f6;
      color: white;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .summary-card {
      background-color: #121315;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .summary-card h3 {
      color: #60a5fa;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .summary-card p {
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
    }

    .summary-card .value {
      font-weight: bold;
      color: #3b82f6;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #2a2d38;
    }

    .admin-title {
      font-size: 1.8rem;
      color: #1977FD;
      text-shadow: 0 0 10px rgba(25, 119, 253, 0.5);
      margin: 0;
    }

    .admin-actions {
      display: flex;
      gap: 10px;
    }

    .admin-btn {
      padding: 8px 16px;
      border-radius: 8px;
      background-color: #1a1a1a;
      color: #FFFBEF;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .admin-btn:hover {
      background-color: #2a2a2a;
    }

    .admin-btn.primary {
      background-color: #3b82f6;
      color: white;
    }

    .admin-btn.primary:hover {
      background-color: #2563eb;
    }

    .admin-btn.logout {
      background-color: #ef4444;
      color: white;
    }

    .admin-btn.logout:hover {
      background-color: #dc2626;
    }

    @media (max-width: 768px) {
      .search-container {
        flex-direction: column;
        align-items: stretch;
      }
      
      .admin-table {
        font-size: 0.8rem;
      }
      
      .admin-table th, 
      .admin-table td {
        padding: 8px 10px;
      }
      
      .summary-cards {
        grid-template-columns: 1fr;
      }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in-up {
      animation: fadeInUp 0.5s ease-out forwards;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div class="admin-container">
    <div class="admin-header">
      <h1 class="admin-title">Адмін Панель</h1>
      <div class="admin-actions">
        <button class="admin-btn primary">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
          </svg>
          Новий співробітник
        </button>
        <button class="admin-btn">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
          </svg>
          Налаштування
        </button>
        <button id="admin-logout-btn" class="admin-btn logout">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd" />
          </svg>
          Вийти
        </button>
      </div>
    </div>

    <div class="summary-cards">
      <div class="summary-card animate-fade-in-up">
        <h3>Загальна статистика</h3>
        <p>Активних співробітників: <span class="value">24</span></p>
        <p>Зараз онлайн: <span class="value">18</span></p>
        <p>Тікетів за день: <span class="value">147</span></p>
      </div>
      
      <div class="summary-card animate-fade-in-up" style="animation-delay: 0.1s">
        <h3>Топ співробітників</h3>
        <p>Тікети (день): <span class="value">Марія - 21</span></p>
        <p>Час у грі (день): <span class="value">Олексій - 6г 45хв</span></p>
        <p>Конкурс: <span class="value">Андрій - 1 місце</span></p>
      </div>
      
      <div class="summary-card animate-fade-in-up" style="animation-delay: 0.2s">
        <h3>Попередження</h3>
        <p>Низька активність: <span class="value">3 співробітники</span></p>
        <p>Не авторизовані: <span class="value">2 співробітники</span></p>
        <p>Потребують перевірки: <span class="value">1 співробітник</span></p>
      </div>
    </div>

    <div class="search-container">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Пошук співробітників...">
      </div>
      <div class="filter-box">
        <button class="filter-btn active">Усі</button>
        <button class="filter-btn">Онлайн</button>
        <button class="filter-btn">Офлайн</button>
        <button class="filter-btn">Топ 10</button>
      </div>
    </div>

    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th data-sort="name">Співробітник</th>
            <th data-sort="status">Статус</th>
            <th data-sort="day-tickets">Тікети (день)</th>
            <th data-sort="day-time">Час (день)</th>
            <th data-sort="week-tickets">Тікети (тиждень)</th>
            <th data-sort="week-time">Час (тиждень)</th>
            <th data-sort="month-tickets">Тікети (місяць)</th>
            <th data-sort="month-time">Час (місяць)</th>
            <th data-sort="rank">Місце</th>
            <th>Дії</th>
          </tr>
        </thead>
        <tbody id="admin-stats-body">
          <!-- Данные будут заполнены через JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // Список разрешенных администраторов
    const allowedAdmins = ['@laker_77', '@admin1', '@admin2', '@supervisor'];
    
    // Данные сотрудников (в реальном приложении будут загружаться с сервера)
    const employees = [
      {
        id: 1,
        name: "Іван Петренко",
        telegram: "@ivan_p",
        status: "online",
        lastLogin: "2023-06-19 14:30",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 15, time: 4.5 },
          week: { tickets: 87, time: 32.1 },
          month: { tickets: 215, time: 98.5 }
        },
        rank: 3
      },
      {
        id: 2,
        name: "Марія Сидорова",
        telegram: "@maria_s",
        status: "online",
        lastLogin: "2023-06-19 14:15",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 21, time: 5.8 },
          week: { tickets: 102, time: 36.7 },
          month: { tickets: 278, time: 124.2 }
        },
        rank: 1
      },
      {
        id: 3,
        name: "Олексій Коваленко",
        telegram: "@alex_k",
        status: "online",
        lastLogin: "2023-06-19 13:45",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 18, time: 6.75 },
          week: { tickets: 95, time: 38.5 },
          month: { tickets: 245, time: 112.3 }
        },
        rank: 2
      },
      {
        id: 4,
        name: "Андрій Мельник",
        telegram: "@andriy_m",
        status: "offline",
        lastLogin: "2023-06-18 18:20",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 8, time: 2.3 },
          week: { tickets: 42, time: 15.8 },
          month: { tickets: 156, time: 68.9 }
        },
        rank: 7
      },
      {
        id: 5,
        name: "Юлія Шевченко",
        telegram: "@julia_s",
        status: "online",
        lastLogin: "2023-06-19 12:10",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 12, time: 3.9 },
          week: { tickets: 68, time: 24.6 },
          month: { tickets: 192, time: 87.4 }
        },
        rank: 5
      },
      {
        id: 6,
        name: "Віктор Павленко",
        telegram: "@viktor_p",
        status: "offline",
        lastLogin: "2023-06-17 16:40",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 0, time: 0 },
          week: { tickets: 24, time: 9.2 },
          month: { tickets: 103, time: 45.1 }
        },
        rank: 12
      },
      {
        id: 7,
        name: "Катерина Бондаренко",
        telegram: "@kateryna_b",
        status: "online",
        lastLogin: "2023-06-19 11:25",
        hasLoggedIn: true,
        stats: {
          day: { tickets: 14, time: 4.2 },
          week: { tickets: 73, time: 26.8 },
          month: { tickets: 201, time: 92.7 }
        },
        rank: 4
      },
      {
        id: 8,
        name: "Сергій Ткаченко",
        telegram: "@sergiy_t",
        status: "never-logged",
        lastLogin: null,
        hasLoggedIn: false,
        stats: {
          day: { tickets: 0, time: 0 },
          week: { tickets: 0, time: 0 },
          month: { tickets: 0, time: 0 }
        },
        rank: 24
      }
    ];

    // Функция для форматирования времени
    function formatTime(hours) {
      if (hours === 0) return "0г 0хв";
      
      const fullHours = Math.floor(hours);
      const minutes = Math.round((hours - fullHours) * 60);
      return `${fullHours}г ${minutes}хв`;
    }

    // Функция для отображения статуса
    function getStatusElement(status, hasLoggedIn) {
      if (!hasLoggedIn) {
        return `<span class="status-indicator never-logged"></span> Не авторизований`;
      }
      
      if (status === "online") {
        return `<span class="status-indicator online"></span> Онлайн`;
      }
      return `<span class="status-indicator offline"></span> Офлайн`;
    }

    // Функция для отображения рейтинга
    function getRankElement(rank) {
      let rankClass = "";
      if (rank === 1) rankClass = "rank-1";
      else if (rank === 2) rankClass = "rank-2";
      else if (rank === 3) rankClass = "rank-3";
      
      return `<span class="rank-badge ${rankClass}">${rank}</span>`;
    }

    // Функция для отображения данных сотрудников в таблице
    function renderEmployeeTable(data) {
      const tbody = document.getElementById("admin-stats-body");
      tbody.innerHTML = "";
      
      data.forEach(employee => {
        const row = document.createElement("tr");
        
        row.innerHTML = `
          <td>
            <div class="font-medium">${employee.name}</div>
            <div class="text-sm text-gray-400">${employee.telegram}</div>
          </td>
          <td>${getStatusElement(employee.status, employee.hasLoggedIn)}</td>
          <td>${employee.stats.day.tickets}</td>
          <td>${formatTime(employee.stats.day.time)}</td>
          <td>${employee.stats.week.tickets}</td>
          <td>${formatTime(employee.stats.week.time)}</td>
          <td>${employee.stats.month.tickets}</td>
          <td>${formatTime(employee.stats.month.time)}</td>
          <td>${getRankElement(employee.rank)}</td>
          <td>
            <button class="admin-btn" title="Переглянути деталі">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // Функция для поиска сотрудников
    function searchEmployees(query) {
      if (!query) return employees;
      
      const lowerQuery = query.toLowerCase();
      return employees.filter(emp => 
        emp.name.toLowerCase().includes(lowerQuery) || 
        emp.telegram.toLowerCase().includes(lowerQuery)
      );
    }

    // Функция сортировки таблицы
    function sortTable(column, direction) {
      const sorted = [...employees];
      
      sorted.sort((a, b) => {
        let valA, valB;
        
        switch(column) {
          case "name":
            valA = a.name.toLowerCase();
            valB = b.name.toLowerCase();
            break;
          case "status":
            // Порядок: online > offline > never-logged
            const statusOrder = { "online": 1, "offline": 2, "never-logged": 3 };
            valA = statusOrder[a.status] || 4;
            valB = statusOrder[b.status] || 4;
            break;
          case "day-tickets":
            valA = a.stats.day.tickets;
            valB = b.stats.day.tickets;
            break;
          case "day-time":
            valA = a.stats.day.time;
            valB = b.stats.day.time;
            break;
          case "week-tickets":
            valA = a.stats.week.tickets;
            valB = b.stats.week.tickets;
            break;
          case "week-time":
            valA = a.stats.week.time;
            valB = b.stats.week.time;
            break;
          case "month-tickets":
            valA = a.stats.month.tickets;
            valB = b.stats.month.tickets;
            break;
          case "month-time":
            valA = a.stats.month.time;
            valB = b.stats.month.time;
            break;
          case "rank":
            valA = a.rank;
            valB = b.rank;
            break;
          default:
            return 0;
        }
        
        if (valA < valB) return direction === "asc" ? -1 : 1;
        if (valA > valB) return direction === "asc" ? 1 : -1;
        return 0;
      });
      
      renderEmployeeTable(sorted);
    }

    // Инициализация страницы
    document.addEventListener("DOMContentLoaded", function() {
      // Проверка авторизации администратора
      const savedAuth = localStorage.getItem("tg_auth");
      if (!savedAuth) {
        alert("Будь ласка, увійдіть через головну сторінку");
        window.location.href = "index.html";
        return;
      }
      
      try {
        const userData = JSON.parse(savedAuth);
        const telegramUsername = userData.username;
        
        // Проверка, является ли пользователь администратором
        if (!allowedAdmins.includes(telegramUsername.toLowerCase())) {
          alert("Ви не маєте доступу до адмін панелі");
          window.location.href = "index.html";
          return;
        }
      } catch (e) {
        localStorage.removeItem("tg_auth");
        window.location.href = "index.html";
      }
      
      // Отображение данных
      renderEmployeeTable(employees);
      
      // Обработка поиска
      document.getElementById("search-input").addEventListener("input", function(e) {
        const results = searchEmployees(e.target.value);
        renderEmployeeTable(results);
      });
      
      // Обработка сортировки
      const headers = document.querySelectorAll(".admin-table th[data-sort]");
      headers.forEach(header => {
        header.addEventListener("click", function() {
          const sortBy = this.getAttribute("data-sort");
          const currentDir = this.getAttribute("data-dir") || "asc";
          const newDir = currentDir === "asc" ? "desc" : "asc";
          
          // Сброс направления для всех заголовков
          headers.forEach(h => h.removeAttribute("data-dir"));
          
          // Установка нового направления
          this.setAttribute("data-dir", newDir);
          
          // Сортировка
          sortTable(sortBy, newDir);
        });
      });
      
      // Обработка кнопки выхода
      document.getElementById("admin-logout-btn").addEventListener("click", function() {
        localStorage.removeItem("tg_auth");
        window.location.href = "index.html";
      });
      
      // Обработка фильтров
      const filterBtns = document.querySelectorAll(".filter-btn");
      filterBtns.forEach(btn => {
        btn.addEventListener("click", function() {
          // Удаляем активный класс у всех кнопок
          filterBtns.forEach(b => b.classList.remove("active"));
          
          // Добавляем активный класс текущей кнопке
          this.classList.add("active");
          
          // Применяем фильтр
          const filterType = this.textContent.trim();
          let filtered = [...employees];
          
          switch(filterType) {
            case "Онлайн":
              filtered = employees.filter(emp => emp.status === "online" && emp.hasLoggedIn);
              break;
            case "Офлайн":
              filtered = employees.filter(emp => emp.status === "offline" && emp.hasLoggedIn);
              break;
            case "Топ 10":
              filtered = [...employees].sort((a, b) => a.rank - b.rank).slice(0, 10);
              break;
          }
          
          renderEmployeeTable(filtered);
        });
      });
    });
  </script>
</body>
</html>
