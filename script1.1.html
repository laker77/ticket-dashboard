<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Оновлення 1.1</title>
  <script async src="https://telegram.org/js/telegram-widget.js?7" 
          data-telegram-login="ticket_tracker_UG_bot" 
          data-size="large"
          data-userpic="false"
          data-request-access="write"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #050608;
      font-family: Arial, sans-serif;
      color: #FFFBEF;
    }
    .container {
      display: flex;
    }
    .sidebar {
      background-color: #121315;
      width: 250px;
      padding: 20px;
      height: 100vh;
      position: sticky;
      top: 0;
    }
    .content {
      padding: 40px;
      max-width: 900px;
    }
    h1, h2, h3 {
      color: #D6567A;
    }
    .highlight {
      color: #D6567A;
      font-weight: bold;
    }
    p, li {
      line-height: 1.6;
    }
    ul {
      padding-left: 20px;
    }
    
    /* Стили для авторизации */
    #login-section {
      background-color: #121824;
      padding: 40px 30px;
      border-radius: 20px;
      max-width: 400px;
      margin: 60px auto;
      box-shadow: 0 0 30px #1977FDAA;
      text-align: center;
      animation: fadeInUp 1.2s ease forwards;
      opacity: 0;
      transform: translateY(30px);
      font-weight: 700;
      font-size: 1.3rem;
    }
    #login-section p {
      margin-bottom: 25px;
      color: #FFFBEF;
      font-weight: 600;
      font-size: 1.1rem;
    }
    .telegram-button-wrapper {
      display: inline-block;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 0 15px #1977FD;
      animation: pulse 3s infinite ease-in-out;
    }
    #logout-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #ff4d4d;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 1001;
      transition: background-color 0.3s;
      border: none;
      font-weight: bold;
    }
    #logout-btn:hover {
      background-color: #e60000;
    }
    .hidden {
      display: none !important;
    }
    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 15px #1977FD;
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 35px #1977FD;
        transform: scale(1.1);
      }
    }
  </style>
</head>
<body>
  <!-- Кнопка выхода (только для авторизованных) -->
  <button id="logout-btn" class="hidden">Вийти</button>

  <!-- Секция авторизации -->
  <div id="login-section">
    <p>Будь ласка, увійдіть через Telegram:</p>
    <div class="telegram-button-wrapper">
      <script async src="https://telegram.org/js/telegram-widget.js?7"
              data-telegram-login="ticket_tracker_UG_bot" 
              data-size="large"
              data-userpic="false"
              data-request-access="write"
              data-onauth="onTelegramAuth(user)">
      </script>
    </div>
  </div>

  <!-- Основной контент (скрыт по умолчанию) -->
  <div id="content" class="hidden">
    <div class="container">
      <div class="sidebar">
        <h2>Оновлення 1.1</h2>
        <ul>
          <li>Інкасатор</li>
          <li>Арена</li>
          <li>Система обміну</li>
          <li>Нові авто</li>
          <li>Інше</li>
        </ul>
      </div>
      <div class="content">
        <h1>Скріпт до оновлення 1.1</h1>
        
        <!-- Остальной контент без изменений -->
        <h2>Робота “Інкасатор”</h2>
        <p>Щоб влаштуватись на роботу Вам потрібно мати:</p>
        <ul>
          <li>Ліцензію на зброю та легковий автомобіль</li>
          <li>8 рівень гравця</li>
          <li>Не перебувати в кримінальних організаціях</li>
        </ul>
        <p>Після підійти до мітки яка є на карті, зайти в будівлю та влаштуватись на роботу та почати зміну (скрін нижче).</p>

        <p class="highlight">Важливо:</p>
        <p>Щоб запросити друзів на роботу він має лиш влаштуватись, а не почати зміну, але ви маєте ОБОВ’ЯЗКОВО почати зміну. Початок зміни — це створення своєї групи!</p>
        <p>Запросити друга до групи можна через “G” - Запросити до групи. Після чого Вам дається одяг та зброя і ви маєте підійти до авто яке позначено міткою на вулиці. Та поїхати до мітки завантаження коштів (буде побудований маршрут).</p>

        <p>Після того як приїхали на мітку, Вам потрібно буде завантажити кошти підійшовши до грошей та натиснувши клавішу “Е”, забравши кошти маєте завантажити в авто через бокові двері (також клавіша “Е”).</p>
        <p>Після завантаження коштів буде побудований маршрут до банкоматів де маєте завантажити їх і таким чином заробляти кошти.</p>
        <p>Завантаження коштів в банкомат треба пройшовши Міні-гру перетаскаючи відповідну купюру до відповідної ячейки.</p>
        <p>Завантаживши всі банкомати ви зможете приїхати назад до місце роботи та знову почати зміну.</p>

        <p>Кримінальні угрупування можуть грабувати інкасаторів через функціонал моду, а саме підійти до багажника через “ТАВ - Пограбувати інкасаторів” і очкувати поки грабується авто. Час очікування 30 секунд. Якщо гравець з LSPD або FIB вбивають людину яка пограбувала інкасаторів, то отримає 10.000 ігрової валюти.</p>
        <p class="highlight">ВАЖЛИВО!</p>
        <p>Щоб грабіжники дотримувались “Правил пограбування інкасаторів”.</p>

        <h2>Арена</h2>
        <p>Місцезнаходження арени позначено на карті кубком.</p>
        <p>Щоб створити лобі потрібно підійти до NPC всередині арени та натиснути клавішу “Е” і в самому меню ви зможете вибрати формат гри.</p>

        <h3>Командний бій:</h3>
        <ul>
          <li>Кількість гравців та раундів</li>
          <li>Зброю</li>
          <li>Мапу</li>
          <li>Суму яку будуть платити за вхід в лобі</li>
          <li>Статус кімнати: зачинений\відчинений (можна ввести пароль)</li>
        </ul>

        <h3>Сам за себе:</h3>
        <ul>
          <li>Кількість гравців</li>
          <li>Час гри</li>
          <li>Озброєння</li>
          <li>Гонка озброєння — зміна зброї після кожного вбивства</li>
          <li>Обране — фіксована зброя на заданий час</li>
          <li>Мапа</li>
          <li>Сума за вхід</li>
          <li>Статус кімнати: зачинений\відчинений</li>
        </ul>
        <p>Вся сума дістається тому, хто виграв битву.</p>

        <h2>Система обміну</h2>
        <p>Щоб обмінятись з гравцем Вам потрібно підійти до нього, натиснути “G - Обмін”, після чого відкриється меню обміну.</p>
        <ul>
          <li>Максимальна сума: 1.000.000</li>
          <li>КД між обміном: немає</li>
        </ul>
        <p>Підтвердження: “Підтвердити обмін” → очікування → “Здійснити обмін”</p>

        <h2>Нові авто</h2>
        <ul>
          <li>Lamborghini Urus - Автосалон</li>
          <li>Tesla Model 3 - Автосалон</li>
          <li>Ford F-150 Raptor - Автосалон</li>
          <li>BMW M3 E36 - Автосалон</li>
          <li>Mercedes-Benz CLS 63 AMG - Автосалон</li>
          <li>Mercedes-Benz CLS 6.3 AMG 2015 - Кейс “Легенда епохи”</li>
          <li>Dodge Challenger SRT Demon - Автосалон</li>
          <li>Freightliner Cascadia 126 BBC - Автосалон далекобійників</li>
          <li>Marcopolo Paradiso - Робота автобусника</li>
          <li>Marcopolo Torino (G7) 2007 - Робота автобусника</li>
          <li>Touareg 2019 - Автосалон</li>
          <li>Ford GT Police - LSPD</li>
          <li>Mercedes AMG GT Police - LSPD</li>
          <li>Mercedes-Benz S600 (W140) - Автосалон</li>
          <li>Mitsubishi Lancer Evolution - Автосалон</li>
          <li>Lamborghini Huracan Performante - Донат</li>
          <li>Toyota Land Cruiser 200 2016 - Автосалон</li>
          <li>Volkswagen Transporter - Робота інкасаторів</li>
          <li>Rolls-Royce Wraith 2015 - Автосалон</li>
          <li>Audi Q5 Sportback - Автосалон</li>
          <li>BMW 750Li 2016 - Автосалон</li>
        </ul>

        <h2>Що ще додали</h2>
        <ul>
          <li>2 нових маршрута автобусника: “Окружний” та “Міжміський”</li>
          <li>Кейс “Легенда епохи”</li>
          <li>Послуга зміни статті та зовнішності</li>
          <li>Новий одяг та аксесуари</li>
          <li>Оренда човнів</li>
          <li>Спавн італійської мафії — нова локація</li>
          <li>Новий інтер’єр пошти</li>
          <li>Квартири (інфо на вікі)</li>
          <li>Інтер’єр риболовного магазину</li>
          <li>Повернення авто через планшет фракції</li>
          <li>Менші мітки на мапі</li>
          <li>2FA через Telegram</li>
          <li>Сумка дає вагу: 10кг (магазин), 20кг (кейс)</li>
          <li>Свап зброї через гарячі клавіші</li>
          <li>Система урону — індивідуально для кожної зброї</li>
        </ul>

        <p class="highlight">ЗА РОЗПОВСЮДЖЕННЯ СКРІПТА — МОМЕНТАЛЬНЕ ЗНЯТТЯ ДА ЧСП ПРОЕКТІВ!</p>
      </div>
    </div>
  </div>

  <script>
    const SHEET_ID = '1fobxr4QwD8CLYFaTh2WXNbGwqQ2mWEuQDPkqDzvzkoU';
    const API_KEY = 'AIzaSyB3NNELU9ok5mkbHQnBEoOfRtNtPb-y5LU';

    async function getSheetData(sheetName) {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(sheetName)}?key=${API_KEY}`;
      const res = await axios.get(url);
      return res.data.values;
    }

    async function onTelegramAuth(user) {
      const telegramUsername = '@' + user.username;
      
      try {
        const ticketsData = await getSheetData('Май_2025_таблица');
        const ticketsHeaders = ticketsData[0];
        const telegramColIndex = ticketsHeaders.indexOf('Telegram');
        
        const userTicketsRow = ticketsData.find(row => 
          row[telegramColIndex]?.trim().toLowerCase() === telegramUsername.toLowerCase()
        );
        
        if (userTicketsRow) {
          // Сохраняем данные пользователя
          const userData = {
            username: telegramUsername,
          };
          localStorage.setItem('tg_auth', JSON.stringify(userData));
          
          // Показываем контент
          showContent();
        } else {
          // Если пользователь не найден
          localStorage.removeItem('tg_auth');
          alert('Користувача не знайдено в таблиці. Доступ заборонено.');
          showLoginForm();
        }
      } catch (error) {
        console.error(error);
        alert('Помилка під час завантаження даних');
        showLoginForm();
      }
    }

    // Функция для показа контента
    function showContent() {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('content').classList.remove('hidden');
      document.getElementById('logout-btn').classList.remove('hidden');
    }

    // Функция для показа формы входа
    function showLoginForm() {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('content').classList.add('hidden');
      document.getElementById('logout-btn').classList.add('hidden');
    }

    // Функция выхода
    function logout() {
      localStorage.removeItem('tg_auth');
      showLoginForm();
    }

    // Проверка сохраненной сессии при загрузке
    document.addEventListener('DOMContentLoaded', function() {
      // Добавляем обработчик для кнопки выхода
      document.getElementById('logout-btn').addEventListener('click', logout);
      
      // Проверяем сохраненную сессию
      const savedAuth = localStorage.getItem('tg_auth');
      if (savedAuth) {
        try {
          showContent();
        } catch (e) {
          localStorage.removeItem('tg_auth');
          showLoginForm();
        }
      }
    });
  </script>
</body>
</html>
